<!DOCTYPE html>
<html>
<head>
    <title>Debug Analysis</title>
</head>
<body>
    <h1>Debug Analysis - Check Console</h1>
    <p>Open browser console to see comprehensive analysis of form inputs and summary outputs.</p>

    <script>
        (function() {
            'use strict';

            console.log('ðŸ” =================================================================');
            console.log('ðŸ” COMPREHENSIVE DEBUG ANALYSIS - Form Inputs & Summary Outputs');
            console.log('ðŸ” =================================================================');

            function getFieldValue(field) {
                if (field.type === 'radio') {
                    const checkedRadio = document.querySelector(`input[name="${field.name}"]:checked`);
                    return checkedRadio ? checkedRadio.value : '';
                } else if (field.type === 'checkbox') {
                    return field.checked ? (field.value || 'Yes') : '';
                } else if (field.tagName.toLowerCase() === 'select') {
                    const selectedOption = field.options[field.selectedIndex];
                    return selectedOption ? selectedOption.text : '';
                } else {
                    return field.value || '';
                }
            }

            function analyzeAllInputs() {
                console.log('ðŸ” ANALYZING ALL FORM INPUTS:');
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const allInputs = document.querySelectorAll(`
                    input[data-step-field-name], 
                    select[data-step-field-name], 
                    textarea[data-step-field-name],
                    input[data-step-field],
                    select[data-step-field],
                    textarea[data-step-field]
                `);
                
                console.log(`ðŸ“Š TOTAL FORM INPUTS FOUND: ${allInputs.length}`);
                
                Array.from(allInputs).forEach((input, index) => {
                    const stepContainer = input.closest('[data-step-type]');
                    const fieldName = input.dataset.stepFieldName || input.dataset.stepField;
                    
                    console.log(`ðŸ“ INPUT ${index + 1}:`, {
                        fieldName: fieldName,
                        type: input.type || input.tagName.toLowerCase(),
                        name: input.name,
                        currentValue: getFieldValue(input),
                        stepType: stepContainer?.dataset.stepType,
                        stepNumber: stepContainer?.dataset.stepNumber,
                        stepSubtype: stepContainer?.dataset.stepSubtype
                    });
                });
            }

            function analyzeSummaryOutputs() {
                console.log('ðŸ” ANALYZING ALL SUMMARY OUTPUTS:');
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const allSummaryFields = document.querySelectorAll('[data-summary-field]');
                
                console.log(`ðŸ“Š TOTAL SUMMARY OUTPUTS FOUND: ${allSummaryFields.length}`);
                
                Array.from(allSummaryFields).forEach((output, index) => {
                    const summaryContainer = output.closest('[data-summary-type]');
                    const fieldName = output.dataset.summaryField;
                    
                    console.log(`ðŸ“‹ OUTPUT ${index + 1}:`, {
                        fieldName: fieldName,
                        currentText: output.textContent?.trim(),
                        summaryType: summaryContainer?.dataset.summaryType,
                        summaryNumber: summaryContainer?.dataset.summaryNumber,
                        summarySubtype: summaryContainer?.dataset.summarySubtype
                    });
                });
            }

            function analyzeEntitySelections() {
                console.log('ðŸ” ANALYZING ENTITY SELECTIONS:');
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const entityFields = document.querySelectorAll(`
                    [data-step-field-name*="Type"],
                    [data-step-field-name*="type"],
                    input[name*="member"],
                    input[name*="entity"],
                    input[name*="management"],
                    input[value="Individual"],
                    input[value="Entity"]
                `);
                
                console.log(`ðŸ“Š ENTITY-RELATED FIELDS FOUND: ${entityFields.length}`);
                
                Array.from(entityFields).forEach((field, index) => {
                    const fieldName = field.dataset.stepFieldName || field.dataset.stepField;
                    const stepContainer = field.closest('[data-step-type]');
                    
                    console.log(`ðŸ¢ ENTITY FIELD ${index + 1}:`, {
                        fieldName: fieldName,
                        name: field.name,
                        type: field.type,
                        value: field.value,
                        currentValue: getFieldValue(field),
                        checked: field.checked,
                        stepType: stepContainer?.dataset.stepType,
                        stepNumber: stepContainer?.dataset.stepNumber,
                        stepSubtype: stepContainer?.dataset.stepSubtype
                    });
                });
            }

            function analyzeChildEntities() {
                console.log('ðŸ” ANALYZING CHILD ENTITIES:');
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const childEntityContainers = document.querySelectorAll('[data-step-type="child-entity"]');
                console.log(`ðŸ“Š CHILD ENTITY FORM CONTAINERS: ${childEntityContainers.length}`);
                
                Array.from(childEntityContainers).forEach((container, index) => {
                    console.log(`ðŸ‘¶ CHILD ENTITY FORM ${index + 1}:`, {
                        stepType: container.dataset.stepType,
                        stepNumber: container.dataset.stepNumber,
                        stepSubtype: container.dataset.stepSubtype
                    });
                    
                    const childFields = container.querySelectorAll('[data-step-field-name], [data-step-field]');
                    console.log(`   â””â”€ Fields in container: ${childFields.length}`);
                    
                    Array.from(childFields).forEach((field, fieldIndex) => {
                        const fieldName = field.dataset.stepFieldName || field.dataset.stepField;
                        console.log(`      â””â”€ Field ${fieldIndex + 1}: ${fieldName} = "${getFieldValue(field)}"`);
                    });
                });
                
                const childSummaryContainers = document.querySelectorAll('[data-summary-type="child-entity"]');
                console.log(`ðŸ“Š CHILD ENTITY SUMMARY CONTAINERS: ${childSummaryContainers.length}`);
                
                Array.from(childSummaryContainers).forEach((container, index) => {
                    console.log(`ðŸ‘¶ CHILD ENTITY SUMMARY ${index + 1}:`, {
                        summaryType: container.dataset.summaryType,
                        summaryNumber: container.dataset.summaryNumber,
                        summarySubtype: container.dataset.summarySubtype
                    });
                });
            }

            function analyzeMatching() {
                console.log('ðŸ” ANALYZING INPUT â†’ OUTPUT MATCHING:');
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const allInputs = document.querySelectorAll(`
                    input[data-step-field-name], select[data-step-field-name], textarea[data-step-field-name],
                    input[data-step-field], select[data-step-field], textarea[data-step-field]
                `);
                
                const allSummaryFields = document.querySelectorAll('[data-summary-field]');
                
                let matchedPairs = 0;
                let unmatchedInputs = 0;
                
                Array.from(allInputs).forEach((input, inputIndex) => {
                    const fieldName = input.dataset.stepFieldName || input.dataset.stepField;
                    const stepContainer = input.closest('[data-step-type]');
                    
                    if (!stepContainer) {
                        console.log(`âŒ INPUT ${inputIndex + 1} (${fieldName}): No step container found`);
                        unmatchedInputs++;
                        return;
                    }
                    
                    const stepType = stepContainer.dataset.stepType;
                    const stepNumber = stepContainer.dataset.stepNumber || '1';
                    const stepSubtype = stepContainer.dataset.stepSubtype;
                    
                    const matchingOutputs = Array.from(allSummaryFields).filter(output => {
                        const outputFieldName = output.dataset.summaryField;
                        const summaryContainer = output.closest('[data-summary-type]');
                        
                        if (!summaryContainer) return false;
                        
                        const summaryType = summaryContainer.dataset.summaryType;
                        const summaryNumber = summaryContainer.dataset.summaryNumber;
                        const summarySubtype = summaryContainer.dataset.summarySubtype;
                        
                        let fieldMatch = outputFieldName === fieldName;
                        if (!fieldMatch && fieldName === 'taxCollection' && outputFieldName === 'taxClassification') {
                            fieldMatch = true;
                        }
                        
                        const contextMatch = summaryType === stepType && 
                                           summaryNumber === stepNumber && 
                                           summarySubtype === stepSubtype;
                        
                        return fieldMatch && contextMatch;
                    });
                    
                    if (matchingOutputs.length > 0) {
                        console.log(`âœ… MATCH: INPUT ${inputIndex + 1} (${fieldName}) â†’ ${matchingOutputs.length} OUTPUT(S)`);
                        matchedPairs++;
                    } else {
                        console.log(`âŒ NO MATCH: INPUT ${inputIndex + 1} (${fieldName}) - Context: ${stepType}-${stepNumber}-${stepSubtype}`);
                        unmatchedInputs++;
                    }
                });
                
                console.log(`ðŸ“Š SUMMARY: âœ… ${matchedPairs} matched, âŒ ${unmatchedInputs} unmatched`);
            }

            function runAnalysis() {
                const form = document.querySelector('[data-form="multistep"]');
                if (!form) {
                    console.log('â³ Waiting for form to load...');
                    setTimeout(runAnalysis, 1000);
                    return;
                }

                analyzeAllInputs();
                analyzeSummaryOutputs();
                analyzeMatching();
                analyzeEntitySelections();
                analyzeChildEntities();
                
                console.log('ðŸ” =================================================================');
                console.log('ðŸ” DEBUG ANALYSIS COMPLETE');
                console.log('ðŸ” =================================================================');
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    setTimeout(runAnalysis, 2000);
                });
            } else {
                setTimeout(runAnalysis, 2000);
            }

        })();
    </script>
</body>
</html> 