!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WebflowSummaryCards=e():t.WebflowSummaryCards=e()}(this,(()=>(()=>{function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=Array(e);a<e;a++)n[a]=t[a];return n}return function(e,a){"use strict";var n={version:"1.0.6-advancement",mainLibraryReady:!1,stepStates:new Map,init:function(){var t=this;console.log("🔄 Summary Cards V6 (Step Advancement Visibility) starting...");var n=function(){var r=void 0!==e.WebflowFieldEnhancer,i=a.querySelector('[data-form="multistep"]'),o=a.querySelectorAll('[data-form="step"]').length>0;r&&i&&o?(console.log("✅ Main library and form ready, initializing summary cards..."),t.mainLibraryReady=!0,setTimeout((function(){t.setup()}),1e3)):(console.log("⏳ Waiting... Main:".concat(r," Form:").concat(!!i," Steps:").concat(o)),setTimeout(n,200))};"loading"===a.readyState?a.addEventListener("DOMContentLoaded",(function(){setTimeout(n,1e3)})):setTimeout(n,1e3)},setup:function(){var t=this;console.log("🔄 Initializing Summary Card System with Step Advancement Visibility..."),this.mainLibraryReady?(this.initializeStepStates(),this.setupAdvancementEventListeners(),this.setupFieldEventListeners(),setTimeout((function(){t.populateInitialValues()}),500)):console.warn("❌ Main library not ready, aborting summary setup")},initializeStepStates:function(){var t=this;a.querySelectorAll("[data-step-type]").forEach((function(e){var a=t.getStepKey(e);t.stepStates.set(a,"UNTOUCHED"),console.log("📝 Initialized step state: ".concat(a," = UNTOUCHED"))}))},getStepKey:function(t){var e=t.dataset.stepType,a=t.dataset.stepNumber||"1",n=t.dataset.stepSubtype||"";return"".concat(e,"-").concat(a,"-").concat(n)},setupAdvancementEventListeners:function(){var t=this,e=new MutationObserver((function(e){e.forEach((function(e){if("attributes"===e.type&&("style"===e.attributeName||"class"===e.attributeName)){var a=e.target;a.matches('[data-form="step"]')&&t.handleStepVisibilityChange(a)}}))}));a.querySelectorAll('[data-form="step"]').forEach((function(t){e.observe(t,{attributes:!0,attributeFilter:["style","class"]})})),a.addEventListener("click",(function(e){(e.target.matches('[data-form="next-btn"]')||e.target.closest('[data-form="next-btn"]'))&&setTimeout((function(){t.markCurrentStepAsCompleted()}),100)}),{passive:!0})},handleStepVisibilityChange:function(t){var e=this;this.isElementVisible(t)||t.querySelectorAll("[data-step-type]").forEach((function(t){var a=e.getStepKey(t);"TOUCHED"===e.stepStates.get(a)&&(e.stepStates.set(a,"COMPLETED"),console.log("✅ Step completed: ".concat(a," (hidden)")),e.updateSummaryVisibility(a))}))},isElementVisible:function(t){return t.offsetHeight>0&&t.offsetWidth>0&&!t.hasAttribute("hidden")&&!t.classList.contains("w-hidden")},markCurrentStepAsCompleted:function(){var t=this,e=a.querySelector('[data-form="step"]:not([style*="display: none"]):not(.w-hidden)');e&&e.querySelectorAll("[data-step-type]").forEach((function(e){var a=t.getStepKey(e);"TOUCHED"===t.stepStates.get(a)&&(t.stepStates.set(a,"COMPLETED"),console.log("✅ Step completed: ".concat(a," (next button)")),t.updateSummaryVisibility(a))}))},updateSummaryVisibility:function(e){var n,r,i=(n=e.split("-"),r=3,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,r,i,o,s=[],c=!0,l=!1;try{if(i=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;c=!1}else for(;!(c=(n=i.call(a)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(l)throw r}}return s}}(n,r)||function(e,a){if(e){if("string"==typeof e)return t(e,a);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,a):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[0],s=i[1],c=i[2],l=a.querySelectorAll('[data-summary-type="'.concat(o,'"][data-summary-number="').concat(s,'"][data-summary-subtype="').concat(c,'"]'));0===l.length&&(l=a.querySelectorAll('[data-summary-type="'.concat(o,'"][data-summary-number="').concat(s,'"]'))),0===l.length&&(l=a.querySelectorAll('[data-summary-type="'.concat(o,'"]'))),l.forEach((function(t){t.style.display="block",t.classList.remove("w-hidden"),t.classList.add("summary-visible"),console.log("👁️ Summary visible: ".concat(e))}))},setupFieldEventListeners:function(){var t=this;a.querySelectorAll('[data-form="multistep"]').forEach((function(e){console.log("📋 Setting up field listeners for form:",e.id||"unnamed"),a.addEventListener("input",(function(a){e.contains(a.target)&&t.shouldHandleField(a.target)&&requestAnimationFrame((function(){t.handleFieldChange(a.target)}))}),{passive:!0,capture:!1}),a.addEventListener("change",(function(a){e.contains(a.target)&&t.shouldHandleField(a.target)&&requestAnimationFrame((function(){t.handleFieldChange(a.target)}))}),{passive:!0,capture:!1}),a.addEventListener("change",(function(a){e.contains(a.target)&&a.target.matches('[data-step-field-name="sameAsMainContact"]')&&requestAnimationFrame((function(){t.handleSameAsMainContact(a.target)}))}),{passive:!0,capture:!1})}))},shouldHandleField:function(t){var e=t.dataset.stepFieldName||t.dataset.stepField,a=t.matches('\n                [data-form="next-btn"], \n                [data-form="back-btn"], \n                [data-form="submit"],\n                [data-go-to], \n                [data-skip],\n                button,\n                [type="submit"],\n                [type="button"],\n                .w-button\n            '),n=t.closest('[data-form="step"]'),r=n&&("none"===n.style.display||n.classList.contains("w-hidden")||n.hasAttribute("hidden"));return e&&!a&&!r},handleFieldChange:function(t){var e=this;if(this.mainLibraryReady){var a=t.dataset.stepFieldName||t.dataset.stepField;if(a){var n=t.closest("[data-step-type]");if(n){var r=this.getStepKey(n);"UNTOUCHED"===this.stepStates.get(r)&&(this.stepStates.set(r,"TOUCHED"),console.log("👆 Step touched: ".concat(r)))}try{var i=this.getFieldValue(t);if("phone"===a||"countryCode"===a)return void this.handlePhoneFieldUpdate(t,a,i);var o=this.findSummaryElements(t,a);o.length>0&&(o.forEach((function(a){e.updateSummaryDisplay(a,i,t)})),console.log("📊 Updated ".concat(o.length," summary element(s) for: ").concat(a,' = "').concat(i,'"')))}catch(t){console.warn("Summary update error:",t)}}}},getFieldValue:function(t){if("radio"===t.type){var e=a.querySelector('input[name="'.concat(t.name,'"]:checked'));return e?e.value:""}if("checkbox"===t.type)return t.checked?t.value||"Yes":"No";if("select"===t.tagName.toLowerCase()){var n=t.options[t.selectedIndex];return n?n.text:""}return t.value||""},handlePhoneFieldUpdate:function(t,e,a){if(this.mainLibraryReady){console.log("📞 Handling phone field update: ".concat(e,' = "').concat(a,'"'));var n=t.closest("[data-step-type]");if(n){var r=n.querySelector('[data-step-field-name="phone"]'),i=n.querySelector('[data-step-field-name="countryCode"]');if(r&&i){var o=this.getFieldValue(r),s=this.getFieldValue(i),c=this.formatInternationalPhone(o,s,i);this.findSummaryElements(r,"phone").forEach((function(t){t.textContent=c,t.classList.add("summary-updated"),setTimeout((function(){t.classList.remove("summary-updated")}),1500)})),console.log('📞 Updated phone summary with: "'.concat(c,'"'))}else console.warn("Could not find both phone and countryCode fields in step")}}},formatInternationalPhone:function(t,e,a){if(!t)return"";try{var n=this.getCountryIsoFromField(a,e);if(n||(n="US"),"function"==typeof parsePhoneNumber)try{var r=parsePhoneNumber(t,n);if(r&&r.isValid())return r.formatInternational()}catch(t){console.warn("Libphonenumber parsing failed:",t)}return this.fallbackPhoneFormat(t,e)}catch(a){return console.warn("Phone formatting error:",a),this.fallbackPhoneFormat(t,e)}},getCountryIsoFromField:function(t,e){if(!t||!e)return null;var a=t.options[t.selectedIndex];if(!a)return null;if(a.dataset.iso)return a.dataset.iso;var n={"+1":"US","+44":"GB","+33":"FR","+49":"DE","+81":"JP","+86":"CN","+91":"IN","+55":"BR","+61":"AU","+7":"RU"};if(n[e])return n[e];var r=a.text.match(/\(\+(\d+)\)/);return r?n["+".concat(r[1])]:"US"},fallbackPhoneFormat:function(t,e){var a=t.replace(/\D/g,""),n=e||"+1";return n.startsWith("+")||(n="+"+n),"+1"!==n&&"+1 "!==n||10!==a.length?"".concat(n," ").concat(t):"+1 (".concat(a.substr(0,3),") ").concat(a.substr(3,3),"-").concat(a.substr(6,4))},findSummaryElements:function(t,e){var n=[],r=t.closest("[data-step-type]");if(!r)return n;var i=r.dataset.stepType,o=r.dataset.stepNumber||"1",s=r.dataset.stepSubtype,c=a.querySelectorAll('[data-summary-type="'.concat(i,'"][data-summary-number="').concat(o,'"][data-summary-subtype="').concat(s,'"]'));return 0===c.length&&(c=a.querySelectorAll('[data-summary-type="'.concat(i,'"][data-summary-number="').concat(o,'"]'))),0===c.length&&(c=a.querySelectorAll('[data-summary-type="'.concat(i,'"]'))),c.forEach((function(t){var a=t.querySelector('[data-summary-field="'.concat(e,'"]'));a&&n.push(a)})),n},updateSummaryDisplay:function(t,e,a){if(this.mainLibraryReady){var n=e;if("tel"===a.type||"phone"===a.dataset.stepFieldName)n=this.formatPhoneForSummary(e,a);else if("countryCode"===a.dataset.stepFieldName){var r;n=(null===(r=a.options[a.selectedIndex])||void 0===r?void 0:r.text)||e}else"checkbox"===a.type&&"sameAsMainContact"!==a.dataset.stepFieldName?n=a.checked?"Yes":"No":"radio"===a.type&&(n=e||"");t.textContent=n||"",t.classList.add("summary-updated"),setTimeout((function(){t.classList.remove("summary-updated")}),1500)}},formatPhoneForSummary:function(t,e){if(!t)return"";var a=e.closest("[data-step-type]"),n=null==a?void 0:a.querySelector('[data-step-field-name="countryCode"]'),r="+1";if(n&&n.value){var i=n.options[n.selectedIndex];i&&"Another option"!==i.value&&(r=i.value)}if(t.length>=10){var o=t.replace(/\D/g,"");if(10===o.length&&("+1"===r||"+1 "===r))return"+1 (".concat(o.substr(0,3),") ").concat(o.substr(3,3),"-").concat(o.substr(6,4))}return"".concat(r," ").concat(t)},handleSameAsMainContact:function(t){if(this.mainLibraryReady&&t.checked){var e=t.closest('[data-step-type="member"]');if(e){var a=this.getMainContactData(),n=this.getStepKey(e);"UNTOUCHED"===this.stepStates.get(n)&&(this.stepStates.set(n,"TOUCHED"),console.log("👆 Step touched (same as main): ".concat(n))),Object.keys(a).forEach((function(t){if(["firstName","lastName","email","address","city","state","country","postalCode","phone"].includes(t)){var n=e.querySelector('[data-step-field-name="'.concat(t,'"]'));if(n){n.value=a[t];var r=new Event("input",{bubbles:!0});n.dispatchEvent(r)}}})),console.log("✅ Same as main contact applied")}}},getMainContactData:function(){var t=this,e=a.querySelector('[data-step-type="contact"][data-step-subtype="info"]');if(!e)return{};var n={};return e.querySelectorAll("[data-step-field-name], [data-step-field]").forEach((function(e){var a=e.dataset.stepFieldName||e.dataset.stepField;a&&(n[a]=t.getFieldValue(e))})),n},populateInitialValues:function(){var t=this;if(this.mainLibraryReady){console.log("📋 Populating initial summary values...");var e=a.querySelectorAll("[data-step-field-name], [data-step-field]"),n=0;e.forEach((function(e){t.shouldHandleField(e)&&(e.value||"radio"===e.type&&e.checked||"checkbox"===e.type&&e.checked)&&(t.handleFieldChange(e),n++)})),console.log("📊 Populated ".concat(n," initial summary values"))}}};console.log("📦 Loading Summary Cards V6 (Step Advancement Visibility)"),n.init(),e.WebflowSummaryCards=n}(window,document),{}})()));