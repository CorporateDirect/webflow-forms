!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WebflowForms=e():t.WebflowForms=e()}(this,(()=>(function(t,e){"use strict";class o{constructor(){this.forms=new Map,this.currentSteps=new Map,this.formData=new Map,this.stepHistory=new Map,this.config={transitionDuration:300,autoInit:!0,validateOnNext:!0,saveProgress:!0},this.config.autoInit&&this.init()}init(){this.injectStyles(),this.hideAllStepsImmediately(),this.initializeForms(),this.setupEventListeners(),console.log("ğŸ¯ Tryformly-compatible system initialized")}hideAllStepsImmediately(){console.log("ğŸ” CLASS HIDING: Starting hideAllStepsImmediately, DOM state:",e.readyState);let o=0;['[data-form="step"]',"[data-step]","[data-step-number]","[data-form-step]",".form-step",".step"].forEach((s=>{const n=e.querySelectorAll(s);console.log(`ğŸ” CLASS: Selector "${s}" found ${n.length} elements`),n.forEach(((e,s)=>{console.log(`ğŸ” CLASS: Processing step ${s+1}:`,e),console.log("ğŸ” CLASS: Current computed styles:",t.getComputedStyle(e).display),e.style.display="none",e.style.visibility="hidden",e.classList.add("step-hidden"),e.classList.add("class-hidden"),console.log("ğŸ” CLASS: After hiding - inline display:",e.style.display),console.log("ğŸ” CLASS: After hiding - computed display:",t.getComputedStyle(e).display),o++}))})),console.log(`ğŸ”’ CLASS HIDING: Pre-hidden ${o} potential steps`),0===o&&console.warn("âš ï¸ CLASS HIDING: No steps found during class initialization!")}initializeForms(){e.querySelectorAll(['[data-form="multistep"]',"[data-multi-step]","[data-formly]","[data-step-form]",".multi-step-form"].join(", ")).forEach((t=>{this.setupForm(t)}))}setupForm(t){const e=t.id||`form-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;t.setAttribute("data-form-id",e);const o=this.findSteps(t);0!==o.length?(this.forms.set(e,{element:t,steps:o,totalSteps:o.length}),this.currentSteps.set(e,0),this.formData.set(e,new Map),this.stepHistory.set(e,[]),this.initializeFormState(e),console.log(`âœ… Form ${e} initialized with ${o.length} steps`)):console.warn("No steps found in form:",t)}findSteps(t){let e=[];const o=['[data-form="step"]',"[data-step]","[data-step-number]","[data-form-step]",".form-step",".step"];for(const s of o)if(e=Array.from(t.querySelectorAll(s)),e.length>0){console.log(`ğŸ“‹ Found ${e.length} steps using selector: ${s}`);break}return 0===e.length?(console.warn("âŒ No steps found in form. Tried selectors:",o),[]):(e.sort(((t,e)=>this.getStepNumber(t)-this.getStepNumber(e))),e.forEach(((t,e)=>{const o=e+1;t.hasAttribute("data-step")||t.hasAttribute("data-form")||t.setAttribute("data-step",o),t.classList.add("form-step")})),e)}getStepNumber(t){return parseInt(t.getAttribute("data-step")||t.getAttribute("data-step-number")||t.getAttribute("data-form-step")||"1")}initializeFormState(e){console.log(`ğŸ” FORM INIT: Starting initializeFormState for ${e}`);const o=this.forms.get(e);o?(console.log(`ğŸ” FORM INIT: Form has ${o.steps.length} steps`),o.steps.forEach(((e,o)=>{console.log(`ğŸ” FORM INIT: Hiding step ${o+1}:`,e),console.log(`ğŸ” FORM INIT: Step ${o+1} classes before hide:`,e.className),console.log(`ğŸ” FORM INIT: Step ${o+1} computed display before:`,t.getComputedStyle(e).display),this.hideStep(e),console.log(`ğŸ” FORM INIT: Step ${o+1} classes after hide:`,e.className),console.log(`ğŸ” FORM INIT: Step ${o+1} computed display after:`,t.getComputedStyle(e).display)})),o.steps.length>0&&(console.log("ğŸ” FORM INIT: Showing first step:",o.steps[0]),this.showStep(o.steps[0]),console.log("ğŸ” FORM INIT: First step classes after show:",o.steps[0].className),console.log("ğŸ” FORM INIT: First step computed display after show:",t.getComputedStyle(o.steps[0]).display)),this.updateProgress(e),this.updateNavigation(e),this.processConditionalLogic(e),console.log(`âœ… FORM INIT: Completed initialization for ${e}`)):console.warn(`âš ï¸ FORM INIT: No form data found for ${e}`)}setupEventListeners(){e.addEventListener("click",this.handleClick.bind(this)),e.addEventListener("change",this.handleChange.bind(this)),e.addEventListener("input",this.handleInput.bind(this))}handleClick(t){const o=t.target,s=this.getFormId(o);if(console.log("ğŸ” CLICK: Element clicked:",o),console.log(`ğŸ” CLICK: Form ID: ${s}`),console.log("ğŸ” CLICK: Element attributes:",{"data-go-to":o.getAttribute("data-go-to"),"data-answer":o.getAttribute("data-answer"),"data-next":o.getAttribute("data-next"),"data-form":o.getAttribute("data-form"),class:o.className}),!s)return void console.warn("âš ï¸ CLICK: No form ID found for clicked element");const n=Date.now();if(n-(o._lastClickTime||0)<500)return console.log("ğŸš« CLICK: Debounced double-click"),void t.preventDefault();o._lastClickTime=n;let i=null,a=null;if("radio"===o.type)i=o,console.log("ğŸ“» CLICK: Direct radio button click");else if("LABEL"===o.tagName){const t=o.getAttribute("for");t?(i=e.getElementById(t),console.log("ğŸ“» CLICK: Label click, found radio:",i)):(i=o.querySelector('input[type="radio"]'),console.log("ğŸ“» CLICK: Label click, radio inside:",i))}else{const t=o.closest(".radio_field, .w-radio, [data-go-to]");t&&(i=t.querySelector('input[type="radio"]'),console.log("ğŸ“» CLICK: Container click, found radio:",i))}if(i&&(console.log("ğŸ“» CLICK: Processing radio button:",i),i.checked||(i.checked=!0,console.log("ğŸ“» CLICK: Selected radio button"),i.dispatchEvent(new Event("change",{bubbles:!0}))),a=this.findElementWithGoToAttributes(i),a)){console.log("ğŸ“» CLICK: Found element with data attributes:",a);const e=a.getAttribute("data-go-to"),o=a.getAttribute("data-answer");if(e){console.log(`ğŸ“» CLICK: Radio has data-go-to="${e}" and data-answer="${o}"`);const n={getAttribute:t=>a.getAttribute(t),name:i.name,value:i.value,type:"radio",checked:!0};return setTimeout((()=>{this.handleGoTo(s,n)}),200),void t.preventDefault()}}this.isNextButton(o)?(console.log("â¡ï¸ CLICK: Next button clicked"),t.preventDefault(),t.stopPropagation(),this.nextStep(s)):this.isPrevButton(o)?(console.log("â¬…ï¸ CLICK: Prev button clicked"),t.preventDefault(),t.stopPropagation(),this.prevStep(s)):this.isSubmitButton(o)?(console.log("ğŸ“¤ CLICK: Submit button clicked"),t.preventDefault(),t.stopPropagation(),this.submitForm(s)):o.hasAttribute("data-go-to")?(console.log("ğŸ¯ CLICK: Element with data-go-to clicked"),t.preventDefault(),t.stopPropagation(),this.handleGoTo(s,o)):o.hasAttribute("data-skip")?(console.log("â­ï¸ CLICK: Element with data-skip clicked"),t.preventDefault(),t.stopPropagation(),this.handleSkip(s,o)):console.log("ğŸ” CLICK: No special handling for this element")}findElementWithGoToAttributes(t){if(t.hasAttribute("data-go-to"))return t;if(t.id){const o=e.querySelector(`label[for="${t.id}"]`);if(o&&o.hasAttribute("data-go-to"))return o}const o=t.closest("label");if(o&&o.hasAttribute("data-go-to"))return o;const s=t.closest(".radio_field, .w-radio, [data-go-to]");return s&&s.hasAttribute("data-go-to")?s:null}handleChange(t){const e=t.target,o=this.getFormId(e);if(o){if(console.log("ğŸ”„ CHANGE: Field changed:",e),this.saveFieldData(o,e),e.hasAttribute("data-answer")&&this.checkConditionalLogic(o,e),"radio"===e.type){console.log("ğŸ“» CHANGE: Radio button changed, checking for navigation attributes");const t=this.findElementWithGoToAttributes(e);if(t&&t.hasAttribute("data-go-to")){console.log("ğŸ“» CHANGE: Found data-go-to on radio element");const s={getAttribute:e=>t.getAttribute(e),name:e.name,value:e.value,type:"radio",checked:e.checked};this.checkConditionalLogic(o,s)}}"radio"===e.type&&e.hasAttribute("data-skip")&&this.handleSkip(o,e)}}handleInput(t){const e=t.target,o=this.getFormId(e);o&&(clearTimeout(e._inputTimeout),e._inputTimeout=setTimeout((()=>{this.saveFieldData(o,e)}),300))}isNextButton(t){return t.matches(['[data-form="next-btn"]',"[data-next]","[data-step-next]","[data-formly-next]",".next-btn",".step-next"].join(", "))}isPrevButton(t){return t.matches(['[data-form="back-btn"]',"[data-prev]","[data-step-prev]","[data-formly-prev]",".prev-btn",".step-prev"].join(", "))}isSubmitButton(t){return t.matches(['[data-form="submit-btn"]',"[data-submit]","[data-step-submit]","[data-formly-submit]",".submit-btn",".step-submit"].join(", "))}nextStep(t){console.log(`ğŸ” NEXT STEP: Starting nextStep for ${t}`);const e=this.forms.get(t);if(!e)return void console.warn(`âš ï¸ NEXT STEP: No form data found for ${t}`);const o=this.currentSteps.get(t);if(console.log(`ğŸ” NEXT STEP: Current step index: ${o} (display: ${o+1})`),this.config.validateOnNext&&!this.validateStep(t,o))return console.log("âŒ NEXT STEP: Validation failed, staying on current step"),!1;this.saveStepData(t,o);const s=this.getNextStepIndex(t,o);return console.log(`ğŸ” NEXT STEP: Next step index: ${s} (display: ${s+1})`),s<e.totalSteps?(console.log(`â¡ï¸ NEXT STEP: Going to step ${s+1}`),this.goToStep(t,s)):(console.log("ğŸ NEXT STEP: Reached end, handling completion"),this.handleComplete(t)),!0}prevStep(t){const e=this.stepHistory.get(t);if(e&&e.length>0){const o=e.pop();this.goToStep(t,o,!1)}}goToStep(t,e){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];console.log(`ğŸ” GO TO STEP: Going from step ${this.currentSteps.get(t)+1} to step ${e+1}`);const s=this.forms.get(t);if(!s)return void console.warn(`âš ï¸ GO TO STEP: No form data found for ${t}`);const n=this.currentSteps.get(t);e!==n?e<0||e>=s.totalSteps?console.warn(`âš ï¸ GO TO STEP: Invalid step index ${e}, total steps: ${s.totalSteps}`):(console.log(`ğŸ” GO TO STEP: Valid transition from ${n+1} to ${e+1}`),o&&e>n&&(this.stepHistory.get(t).push(n),console.log(`ğŸ“š GO TO STEP: Added step ${n+1} to history`)),console.log(`ğŸ” GO TO STEP: Hiding current step ${n+1}`),this.hideStep(s.steps[n]),setTimeout((()=>{console.log(`ğŸ” GO TO STEP: Showing target step ${e+1}`),this.showStep(s.steps[e]),this.currentSteps.set(t,e),this.updateProgress(t),this.updateNavigation(t),this.triggerStepChangeEvent(t,e,n),console.log(`âœ… GO TO STEP: Successfully moved to step ${e+1}`)}),this.config.transitionDuration)):console.log(`ğŸ” GO TO STEP: Already on target step ${e+1}, skipping`)}getNextStepIndex(t,e){const o=this.forms.get(t);let s=e+1;for(;s<o.totalSteps&&this.shouldSkipStep(t,s);)console.log(`â­ï¸ Skipping step ${s+1}`),s++;return s}shouldSkipStep(t,e){const o=this.forms.get(t).steps[e],s=this.formData.get(t),n=o.getAttribute("data-skip-if");return!!n&&this.evaluateSkipCondition(n,s)}evaluateSkipCondition(t,e){const o=t.match(/^(.+?)(=|!=)(.+)$/);if(!o)return!1;const[,s,n,i]=o,a=i.split(",").map((t=>t.trim())),r=e.get(s.trim());return"!="===n?a.includes(r):!a.includes(r)}handleGoTo(t,e){const o=e.getAttribute("data-go-to"),s=e.getAttribute("data-answer");if(console.log(`ğŸ” HANDLE GO-TO: Processing data-go-to="${o}" with data-answer="${s}"`),s){const t=this.getElementValue(e);if(console.log(`ğŸ” HANDLE GO-TO: Element value: "${t}", required: "${s}"`),t!==s)return void console.log("âŒ HANDLE GO-TO: Answer doesn't match, not navigating")}const n=this.formData.get(t);if(n&&(n.set("_lastGoTo",o),n.set("_currentNavigation",o),console.log(`ğŸ” HANDLE GO-TO: Stored navigation data: _lastGoTo="${o}", _currentNavigation="${o}"`)),/^\d+$/.test(o)){const e=parseInt(o)-1;console.log(`ğŸ” HANDLE GO-TO: Numeric step "${o}" -> index ${e}`),e>=0&&this.goToStep(t,e)}else if(o.startsWith("step-")){const e=o.replace("step-","");if(/^\d+$/.test(e)){const s=parseInt(e)-1;console.log(`ğŸ” HANDLE GO-TO: Named step "${o}" -> step ${e} -> index ${s}`),s>=0&&this.goToStep(t,s)}else console.warn(`âš ï¸ HANDLE GO-TO: Invalid step name format: ${o}`)}else console.log(`ğŸŒ³ HANDLE GO-TO: Branch navigation to "${o}"`),console.log("ğŸŒ³ HANDLE GO-TO: This should go to next step and show wrapper with matching data-answer"),n&&(n.set("_branchTarget",o),console.log(`ğŸŒ³ HANDLE GO-TO: Stored branch target: "${o}"`)),this.nextStep(t)}checkConditionalLogic(t,e){const o=e.getAttribute("data-go-to"),s=e.getAttribute("data-answer");if(console.log(`ğŸŒ³ CONDITIONAL: Checking field with data-go-to="${o}", data-answer="${s}"`),o&&s){const n=this.getElementValue(e);if(console.log(`ğŸŒ³ CONDITIONAL: Field value="${n}", required answer="${s}"`),"radio"===e.type&&!e.checked)return void console.log("ğŸŒ³ CONDITIONAL: Radio button not checked, skipping");n===s?(console.log(`ğŸŒ³ CONDITIONAL: Values match! Triggering navigation to "${o}"`),setTimeout((()=>{this.handleGoTo(t,e)}),100)):console.log("ğŸŒ³ CONDITIONAL: Values don't match, no navigation")}else console.log("ğŸŒ³ CONDITIONAL: No conditional logic on this field")}handleSkip(t,e){const o=e.getAttribute("data-skip");if(o){const e=parseInt(o)-1;this.goToStep(t,e)}else this.nextStep(t)}validateStep(t,e){const o=this.forms.get(t);if(!o)return!0;const s=o.steps[e].querySelectorAll("[required]");let n=!0;const i=[];return s.forEach((t=>{this.isFieldValid(t)?this.clearFieldError(t):(n=!1,i.push(t),this.markFieldError(t))})),n||(this.showValidationErrors(t,e,i),i.length>0&&i[0].focus()),n}isFieldValid(t){if(!t.required)return!0;switch(t.type){case"radio":const o=e.querySelectorAll(`[name="${t.name}"]`);return Array.from(o).some((t=>t.checked));case"checkbox":return t.checked;case"email":return t.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value);default:return""!==t.value.trim()}}markFieldError(t){t.classList.add("field-error","error"),t.setAttribute("aria-invalid","true")}clearFieldError(t){t.classList.remove("field-error","error"),t.removeAttribute("aria-invalid")}showValidationErrors(t,o,s){const n=this.forms.get(t).steps[o];n.querySelectorAll(".validation-error-message").forEach((t=>t.remove()));const i=e.createElement("div");i.className="validation-error-message",i.innerHTML=`\n                <div class="error-content">\n                    <strong>âš ï¸ Please complete these fields:</strong>\n                    <ul>\n                        ${s.map((t=>`<li>${this.getFieldLabel(t)}</li>`)).join("")}\n                    </ul>\n                </div>\n            `,n.insertBefore(i,n.firstChild),setTimeout((()=>{i.parentNode&&(i.classList.add("fade-out"),setTimeout((()=>i.remove()),300))}),5e3)}getFieldLabel(t){const o=e.querySelector(`label[for="${t.id}"]`)||t.closest("label")||"LABEL"===t.previousElementSibling?.tagName?t.previousElementSibling:null;return o?o.textContent.trim().replace(/\*\s*$/,""):t.getAttribute("placeholder")||t.name||"Required field"}saveFieldData(t,e){const o=this.formData.get(t);if(!o||!e.name)return;const s=this.getElementValue(e);o.set(e.name,s)}saveStepData(t,e){const o=this.forms.get(t);o&&o.steps[e].querySelectorAll("input, select, textarea").forEach((e=>{this.saveFieldData(t,e)}))}getElementValue(t){switch(t.type){case"radio":return t.checked?t.value:null;case"checkbox":return t.checked;default:return t.value}}showStep(o){console.log("ğŸ” SHOW STEP: Showing step:",o),console.log("ğŸ” SHOW STEP: Classes before show:",o.className),console.log("ğŸ” SHOW STEP: Computed display before:",t.getComputedStyle(o).display),o.style.setProperty("display","block","important"),o.style.setProperty("visibility","visible","important"),o.style.setProperty("opacity","1","important"),o.style.setProperty("position","relative","important"),o.style.setProperty("left","auto","important"),o.style.setProperty("top","auto","important"),o.style.setProperty("width","auto","important"),o.style.setProperty("height","auto","important"),o.style.setProperty("overflow","visible","important"),o.style.setProperty("pointer-events","auto","important"),o.style.setProperty("z-index","auto","important"),o.classList.remove("step-hidden","immediately-hidden","class-hidden"),o.classList.add("step-visible","step-enter"),["step-hidden","immediately-hidden","class-hidden"].forEach((t=>{o.classList.contains(t)&&(o.classList.remove(t),console.log(`ğŸ”§ SHOW STEP: Force removed class: ${t}`))})),console.log("ğŸ” SHOW STEP: Classes after show:",o.className),console.log("ğŸ” SHOW STEP: Inline styles after:",{display:o.style.display,visibility:o.style.visibility,opacity:o.style.opacity}),console.log("ğŸ” SHOW STEP: Computed display after:",t.getComputedStyle(o).display);let s=o.parentElement,n=1;for(;s&&n<=3;){const e=t.getComputedStyle(s);console.log(`ğŸ” SHOW STEP: Parent ${n} (${s.tagName}.${s.className}):`,{display:e.display,visibility:e.visibility,opacity:e.opacity,overflow:e.overflow,height:e.height,maxHeight:e.maxHeight}),s=s.parentElement,n++}const i=o.getBoundingClientRect(),a=t.getComputedStyle(o);console.log("ğŸ” SHOW STEP: Element position:",{top:i.top,left:i.left,width:i.width,height:i.height,visible:i.width>0&&i.height>0}),console.log("ğŸ” SHOW STEP: Potential visibility blockers:",{zIndex:a.zIndex,transform:a.transform,backgroundColor:a.backgroundColor,color:a.color,fontSize:a.fontSize,lineHeight:a.lineHeight,textIndent:a.textIndent,clipPath:a.clipPath,mask:a.mask});const r=e.elementFromPoint(i.left+i.width/2,i.top+i.height/2);if(console.log("ğŸ” SHOW STEP: Element at step position:",r),console.log("ğŸ” SHOW STEP: Is step the top element?",r===o||o.contains(r)),this.showStepWrappers(o),setTimeout((()=>{const t=o.querySelector('input:not([type="hidden"]), select, textarea');t&&t.focus()}),this.config.transitionDuration),o.style.border="5px solid red",o.style.backgroundColor="rgba(255, 0, 0, 0.1)",o.style.zIndex="9999",console.log("ğŸ”§ SHOW STEP: Added red border for visual debugging"),0===i.width||0===i.height){console.log("ğŸ”§ SHOW STEP: Step has no dimensions, forcing visibility"),o.style.display="block",o.style.visibility="visible",o.style.opacity="1",o.style.position="static",o.style.width="auto",o.style.height="auto",o.style.overflow="visible",o.offsetHeight;const t=o.getBoundingClientRect();console.log("ğŸ”§ SHOW STEP: After force - dimensions:",{width:t.width,height:t.height})}console.log("âœ… SHOW STEP: Step should now be visible")}hideStep(e){console.log("ğŸ” HIDE STEP: Hiding step:",e),console.log("ğŸ” HIDE STEP: Classes before hide:",e.className),console.log("ğŸ” HIDE STEP: Computed display before:",t.getComputedStyle(e).display),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),e.style.setProperty("position","absolute","important"),e.style.setProperty("left","-9999px","important"),e.style.setProperty("top","-9999px","important"),e.style.setProperty("pointer-events","none","important"),e.classList.remove("step-visible","step-enter"),e.classList.add("step-hidden"),console.log("ğŸ” HIDE STEP: Classes after hide:",e.className),console.log("ğŸ” HIDE STEP: Inline styles after:",{display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity}),console.log("ğŸ” HIDE STEP: Computed display after:",t.getComputedStyle(e).display),console.log("âœ… HIDE STEP: Step should now be hidden")}showStepWrappers(t){const e=this.getFormId(t);if(!e)return;const o=this.formData.get(e);if(!o)return;const s=t.querySelectorAll("[data-answer]");if(0===s.length)return void console.log("ğŸ“‹ STEP WRAPPER: No step-wrappers found in this step");console.log(`ğŸ“‹ STEP WRAPPER: Found ${s.length} step-wrappers`),s.forEach(((t,e)=>{const o=t.getAttribute("data-answer");console.log(`ğŸ“‹ STEP WRAPPER: Wrapper ${e+1} has data-answer="${o}"`),t.style.display="none",t.classList.remove("wrapper-visible"),t.classList.add("wrapper-hidden")}));const n=this.getActiveStepWrapper(t,o);if(n)n.style.display="block",n.classList.remove("wrapper-hidden"),n.classList.add("wrapper-visible"),console.log(`ğŸ“‹ STEP WRAPPER: Showing wrapper with data-answer="${n.getAttribute("data-answer")}"`);else{const e=t.querySelector('[data-answer=""]');if(e)e.style.display="block",e.classList.remove("wrapper-hidden"),e.classList.add("wrapper-visible"),console.log('ğŸ“‹ STEP WRAPPER: Showing first step wrapper (data-answer="")');else{const t=s[0];t&&(t.style.display="block",t.classList.remove("wrapper-hidden"),t.classList.add("wrapper-visible"),console.log(`ğŸ“‹ STEP WRAPPER: No empty wrapper found, showing first wrapper with data-answer="${t.getAttribute("data-answer")}"`))}}}getActiveStepWrapper(t,e){const o=t.querySelectorAll("[data-answer]");for(const t of o){const o=t.getAttribute("data-answer");if(""!==o&&this.hasMatchingFormValue(e,o))return t}return null}hasMatchingFormValue(t,e){console.log(`ğŸ” WRAPPER MATCH: Checking if form data matches "${e}"`);for(const[o,s]of t)if(console.log(`ğŸ” WRAPPER MATCH: Field "${o}" = "${s}"`),s===e)return console.log(`âœ… WRAPPER MATCH: Found match in field "${o}"`),!0;const o=t.get("_lastGoTo"),s=t.get("_currentNavigation"),n=t.get("_branchTarget");return console.log(`ğŸ” WRAPPER MATCH: Navigation data - _lastGoTo="${o}", _currentNavigation="${s}", _branchTarget="${n}"`),o===e||s===e||n===e?(console.log("âœ… WRAPPER MATCH: Found match in navigation data"),!0):(console.log(`âŒ WRAPPER MATCH: No match found for "${e}"`),!1)}updateProgress(t){const e=this.forms.get(t);if(!e)return;const o=this.currentSteps.get(t),s=(o+1)/e.totalSteps*100;e.element.querySelectorAll("[data-progress], [data-step-progress], .progress-bar").forEach((t=>{t.style.width=`${s}%`,t.setAttribute("aria-valuenow",s)})),e.element.querySelectorAll("[data-step-indicator], .step-indicator").forEach(((t,e)=>{t.classList.toggle("active",e===o),t.classList.toggle("completed",e<o)})),e.element.querySelectorAll("[data-step-counter], .step-counter").forEach((t=>{t.textContent=`${o+1} of ${e.totalSteps}`}))}updateNavigation(t){const e=this.forms.get(t);if(!e)return;const o=this.currentSteps.get(t),s=0===o,n=o===e.totalSteps-1;e.element.querySelectorAll("[data-prev], [data-step-prev], [data-formly-prev], .prev-btn").forEach((t=>{t.style.display=s?"none":"",t.disabled=s})),e.element.querySelectorAll("[data-next], [data-step-next], [data-formly-next], .next-btn").forEach((t=>{t.style.display=n?"none":""})),e.element.querySelectorAll("[data-submit], [data-step-submit], [data-formly-submit], .submit-btn").forEach((t=>{t.style.display=n?"":"none"}))}handleComplete(t){const e=this.forms.get(t);if(!e)return;const o=e.element.querySelector("[data-final-step], [data-success-step], .final-step");o?this.showFinalStep(t,o):this.submitForm(t)}showFinalStep(t,e){const o=this.forms.get(t).steps[this.currentSteps.get(t)];this.hideStep(o),setTimeout((()=>{this.showStep(e)}),this.config.transitionDuration)}submitForm(t){const e=this.forms.get(t);if(!e)return;const o=this.currentSteps.get(t);if(!this.validateStep(t,o))return;this.saveStepData(t,o);const s=Object.fromEntries(this.formData.get(t)),n=new CustomEvent("multiStepSubmit",{detail:{formId:t,formData:s,totalSteps:e.totalSteps}});e.element.dispatchEvent(n),this.injectHiddenInputs(t,s),e.element.hasAttribute("data-custom-submit")||e.element.submit()}injectHiddenInputs(t,o){const s=this.forms.get(t);if(!s)return;const n=s.element;n.querySelectorAll("[data-injected-input]").forEach((t=>t.remove())),Object.entries(o).forEach((t=>{let[o,s]=t;if(n.querySelector(`[name="${o}"]:not([data-injected-input])`))return;const i=e.createElement("input");i.type="hidden",i.name=o,i.value=s||"",i.setAttribute("data-injected-input","true"),n.appendChild(i)}))}triggerStepChangeEvent(t,e,o){const s=this.forms.get(t);if(!s)return;const n=new CustomEvent("stepChange",{detail:{formId:t,currentStep:e+1,previousStep:o+1,totalSteps:s.totalSteps,direction:e>o?"forward":"backward",formData:Object.fromEntries(this.formData.get(t))}});s.element.dispatchEvent(n)}processConditionalLogic(t){const e=this.forms.get(t);e&&e.element.querySelectorAll("[data-go-to], [data-answer], [data-skip]").forEach((t=>{t.hasAttribute("data-go-to")&&t.classList.add("has-goto-logic"),t.hasAttribute("data-skip")&&t.classList.add("has-skip-logic")}))}getFormId(t){const e=t.closest("[data-form-id]");return e?e.getAttribute("data-form-id"):null}injectStyles(){if(e.getElementById("tryformly-compatible-styles"))return;const o=e.createElement("style");o.id="tryformly-compatible-styles",o.textContent='\n                /* Step transitions */\n                .form-step, .step {\n                    transition: opacity 300ms ease, transform 300ms ease;\n                }\n                \n                /* Hide steps by default - AGGRESSIVE */\n                [data-form="step"]:not(.step-visible), \n                [data-step]:not(.step-visible), \n                [data-step-number]:not(.step-visible), \n                [data-form-step]:not(.step-visible), \n                .form-step:not(.step-visible), \n                .step:not(.step-visible) {\n                    display: none !important;\n                    visibility: hidden !important;\n                    opacity: 0 !important;\n                    position: absolute !important;\n                    left: -9999px !important;\n                }\n                \n                .step-hidden {\n                    display: none !important;\n                    opacity: 0;\n                    transform: translateX(-20px);\n                    pointer-events: none;\n                }\n                \n                .step-visible {\n                    display: block !important;\n                    visibility: visible !important;\n                    opacity: 1 !important;\n                    position: static !important;\n                    left: auto !important;\n                    transform: translateX(0) !important;\n                }\n                \n                /* Ensure visible steps override all hiding classes */\n                [data-form="step"].step-visible,\n                [data-step].step-visible,\n                [data-step-number].step-visible,\n                [data-form-step].step-visible,\n                .form-step.step-visible,\n                .step.step-visible,\n                .multi-form_step.step-visible {\n                    display: block !important;\n                    visibility: visible !important;\n                    opacity: 1 !important;\n                    position: static !important;\n                    left: auto !important;\n                    transform: none !important;\n                    width: auto !important;\n                    height: auto !important;\n                    overflow: visible !important;\n                    z-index: auto !important;\n                    top: auto !important;\n                    right: auto !important;\n                    bottom: auto !important;\n                }\n                \n                /* Override any Webflow multi-form hiding */\n                .multi-form_step:not(.step-visible) {\n                    display: none !important;\n                }\n                \n                /* Force visible with maximum specificity */\n                div[data-form="step"].multi-form_step.step-visible {\n                    display: block !important;\n                    visibility: visible !important;\n                    opacity: 1 !important;\n                }\n                \n                .step-enter {\n                    animation: stepEnter 300ms ease;\n                }\n                \n                .step-exit {\n                    animation: stepExit 300ms ease;\n                }\n                \n                @keyframes stepEnter {\n                    from {\n                        opacity: 0;\n                        transform: translateX(30px);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: translateX(0);\n                    }\n                }\n                \n                @keyframes stepExit {\n                    from {\n                        opacity: 1;\n                        transform: translateX(0);\n                    }\n                    to {\n                        opacity: 0;\n                        transform: translateX(-30px);\n                    }\n                }\n                \n                /* Validation styles */\n                .field-error {\n                    border-color: #dc3545 !important;\n                    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;\n                }\n                \n                .validation-error-message {\n                    background: #f8d7da;\n                    border: 1px solid #f5c6cb;\n                    color: #721c24;\n                    padding: 15px;\n                    margin: 15px 0;\n                    border-radius: 6px;\n                    animation: errorSlideIn 300ms ease;\n                }\n                \n                .validation-error-message.fade-out {\n                    animation: errorSlideOut 300ms ease;\n                }\n                \n                @keyframes errorSlideIn {\n                    from {\n                        opacity: 0;\n                        transform: translateY(-10px);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: translateY(0);\n                    }\n                }\n                \n                @keyframes errorSlideOut {\n                    from {\n                        opacity: 1;\n                        transform: translateY(0);\n                    }\n                    to {\n                        opacity: 0;\n                        transform: translateY(-10px);\n                    }\n                }\n                \n                /* Conditional logic indicators */\n                .has-goto-logic {\n                    position: relative;\n                }\n                \n                .has-goto-logic::after {\n                    content: "â†’";\n                    position: absolute;\n                    right: 10px;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    color: #007bff;\n                    font-weight: bold;\n                    pointer-events: none;\n                }\n                \n                .has-skip-logic {\n                    position: relative;\n                }\n                \n                .has-skip-logic::after {\n                    content: "â­";\n                    position: absolute;\n                    right: 10px;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    color: #ffc107;\n                    pointer-events: none;\n                }\n                \n                /* Progress indicators */\n                .step-indicator {\n                    width: 30px;\n                    height: 30px;\n                    border-radius: 50%;\n                    background: #e9ecef;\n                    color: #6c757d;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-weight: bold;\n                    transition: all 300ms ease;\n                }\n                \n                .step-indicator.active {\n                    background: #007bff;\n                    color: white;\n                }\n                \n                .step-indicator.completed {\n                    background: #28a745;\n                    color: white;\n                }\n                \n                /* Step-wrapper branching logic */\n                [data-answer] {\n                    transition: all 300ms ease;\n                }\n                \n                [data-answer].wrapper-hidden {\n                    opacity: 0;\n                    transform: translateX(-20px);\n                    pointer-events: none;\n                }\n                \n                [data-answer].wrapper-visible {\n                    opacity: 1;\n                    transform: translateX(0);\n                    pointer-events: auto;\n                }\n            ',e.head.appendChild(o),console.log("ğŸ¨ CSS: Injected tryformly-compatible styles"),setTimeout((()=>{const o=e.querySelectorAll('[data-form="step"]');if(o.length>0){const e=o[0],s=t.getComputedStyle(e);console.log("ğŸ¨ CSS: Test step computed display:",s.display),console.log("ğŸ¨ CSS: Test step classes:",e.className)}}),100)}getCurrentStep(t){const e=t.getAttribute("data-form-id");return(this.currentSteps.get(e)||0)+1}getFormData(t){const e=t.getAttribute("data-form-id"),o=this.formData.get(e);return o?Object.fromEntries(o):{}}goToStepManual(t,e){const o=t.getAttribute("data-form-id");this.goToStep(o,e-1)}getTotalSteps(t){const e=t.getAttribute("data-form-id"),o=this.forms.get(e);return o?o.totalSteps:0}}let s;function n(){s=new o,s.init(),t.Formly=s,t.TryformlyCompatible=s,console.log("ğŸ¯ Tryformly-compatible system ready")}!function(){console.log("ğŸ” IMMEDIATE HIDING: Script executing, DOM state:",e.readyState);const t=e.createElement("style");t.id="immediate-step-hiding",t.innerHTML='\n            /* IMMEDIATE HIDING - Maximum specificity to override Webflow */\n            [data-form="step"]:not(.step-visible),\n            [data-step]:not(.step-visible),\n            [data-step-number]:not(.step-visible),\n            [data-form-step]:not(.step-visible),\n            .form-step:not(.step-visible),\n            .step:not(.step-visible) {\n                display: none !important;\n                visibility: hidden !important;\n                opacity: 0 !important;\n                position: absolute !important;\n                left: -9999px !important;\n                top: -9999px !important;\n                width: 0 !important;\n                height: 0 !important;\n                overflow: hidden !important;\n                pointer-events: none !important;\n                z-index: -1 !important;\n            }\n            \n            /* Ensure step-visible class shows steps */\n            [data-form="step"].step-visible,\n            [data-step].step-visible,\n            [data-step-number].step-visible,\n            [data-form-step].step-visible,\n            .form-step.step-visible,\n            .step.step-visible {\n                display: block !important;\n                visibility: visible !important;\n                opacity: 1 !important;\n                position: relative !important;\n                left: auto !important;\n                top: auto !important;\n                width: auto !important;\n                height: auto !important;\n                overflow: visible !important;\n                pointer-events: auto !important;\n                z-index: auto !important;\n            }\n        ',e.head?e.head.insertBefore(t,e.head.firstChild):new MutationObserver(((o,s)=>{e.head&&(e.head.insertBefore(t,e.head.firstChild),s.disconnect())})).observe(e.documentElement,{childList:!0}),console.log("ğŸ’‰ IMMEDIATE: Injected aggressive step hiding CSS");const o=['[data-form="step"]',"[data-step]","[data-step-number]","[data-form-step]",".form-step",".step"];let s=0;if(o.forEach((t=>{const o=e.querySelectorAll(t);console.log(`ğŸ” IMMEDIATE: Selector "${t}" found ${o.length} elements`),o.forEach(((e,o)=>{console.log(`ğŸ” IMMEDIATE: Hiding step ${o+1} with selector "${t}":`,e),console.log("ğŸ” IMMEDIATE: Step classes before:",e.className),console.log("ğŸ” IMMEDIATE: Step styles before:",{display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity}),e.classList.remove("step-visible"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),e.style.setProperty("position","absolute","important"),e.style.setProperty("left","-9999px","important"),e.style.setProperty("top","-9999px","important"),e.style.setProperty("pointer-events","none","important"),e.classList.add("immediately-hidden"),console.log("ğŸ” IMMEDIATE: Step styles after:",{display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity}),s++}))})),console.log(`âš¡ IMMEDIATE HIDING: Processed ${s} total steps`),0===s){console.warn("âš ï¸ IMMEDIATE HIDING: No steps found! DOM might not be ready or selectors might be wrong"),console.log("ğŸ” IMMEDIATE: Available elements in DOM:",e.querySelectorAll("*").length);const t=new MutationObserver((t=>{let e=0;t.forEach((t=>{t.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&o.forEach((o=>{t.matches&&t.matches(o)&&(console.log("ğŸ” MUTATION: Found new step:",t),t.classList.remove("step-visible"),t.style.setProperty("display","none","important"),t.style.setProperty("visibility","hidden","important"),t.classList.add("immediately-hidden"),e++);const s=t.querySelectorAll&&t.querySelectorAll(o);s&&s.forEach((t=>{console.log("ğŸ” MUTATION: Found child step:",t),t.classList.remove("step-visible"),t.style.setProperty("display","none","important"),t.style.setProperty("visibility","hidden","important"),t.classList.add("immediately-hidden"),e++}))}))}))})),e>0&&console.log(`ğŸ” MUTATION: Hidden ${e} new steps`)}));t.observe(e.body||e.documentElement,{childList:!0,subtree:!0}),setTimeout((()=>t.disconnect()),5e3)}}(),"loading"===e.readyState?e.addEventListener("DOMContentLoaded",n):n()}(window,document),{})));